<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="popup.css">
    <script src="popup.js"></script>
</head>
<body>
    <div class="container">
        <h1>History Sync</h1>
        
        <!-- Connection Status -->
        <div class="status-section">
            <div class="status-indicator" id="connectionStatus">
                <span class="status-dot"></span>
                <span class="status-text">Disconnected</span>
            </div>
        </div>
        
        <!-- Search Section -->
        <div class="search-section">
            <input type="text" id="searchInput" placeholder="Search history..." class="search-input">
            <button id="searchButton" class="btn btn-primary">Search</button>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" data-tab="history">History</button>
            <button class="tab-button" data-tab="devices">Devices</button>
            <button class="tab-button" data-tab="settings">Settings</button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- History Tab -->
            <div id="historyTab" class="tab-pane active">
                <div class="filter-section">
                    <select id="deviceFilter" class="device-filter">
                        <option value="">All Devices</option>
                    </select>
                </div>
                <div id="historyList" class="history-list">
                    <p class="empty-state">No history entries yet</p>
                </div>
            </div>
            
            <!-- Devices Tab -->
            <div id="devicesTab" class="tab-pane">
                <div id="devicesList" class="devices-list">
                    <p class="empty-state">No connected devices</p>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-pane">
                <div class="settings-section">
                    <h3>Connection Settings</h3>
                    
                    <div class="form-group">
                        <label for="discoveryMethod">Discovery Method:</label>
                        <select id="discoveryMethod" class="form-control">
                            <option value="websocket">WebSocket Server (Default)</option>
                            <option value="stun-only">STUN Only (Manual Exchange)</option>
                            <option value="cloudflare-dns">Cloudflare DNS (Your Domain)</option>
                        </select>
                    </div>
                    
                    <!-- WebSocket Settings -->
                    <div id="websocketSettings" class="discovery-settings">
                        <div class="form-group">
                            <label for="serverUrl">Signaling Server URL:</label>
                            <input type="text" id="serverUrl" placeholder="ws://localhost:8080">
                        </div>
                        
                        <div class="form-group">
                            <label for="roomId">Room ID:</label>
                            <input type="text" id="roomId" placeholder="history-sync-default">
                        </div>
                        
                        <div class="form-group">
                            <label for="sharedSecret">Shared Secret:</label>
                            <input type="password" id="sharedSecret" placeholder="Enter shared secret">
                            <button id="generateSecret" class="btn btn-secondary">Generate</button>
                        </div>
                    </div>
                    
                    <!-- STUN Settings -->
                    <div id="stunSettings" class="discovery-settings" style="display: none;">
                        <div class="form-group">
                            <label for="stunServers">STUN Servers (one per line):</label>
                            <textarea id="stunServers" rows="5" placeholder="stun:stun.l.google.com:19302&#10;stun:stun1.l.google.com:19302"></textarea>
                        </div>
                        
                        <div class="connection-flow" id="connectionFlow" style="display: none;">
                            <!-- Connection Step 1: Create Offer -->
                            <div id="createOfferStep" class="connection-step">
                                <h4>Step 1: Create Connection Request</h4>
                                <p>Share this with the device you want to connect to:</p>
                                <button id="createOffer" class="btn btn-primary">Create Connection Request</button>
                            </div>
                            
                            <!-- Connection Step 2: Share Offer -->
                            <div id="shareOfferStep" class="connection-step" style="display: none;">
                                <h4>Step 2: Share Connection Request</h4>
                                <div class="share-options">
                                    <button id="shareViaChat" class="btn btn-secondary">
                                        <span class="icon">ðŸ’¬</span> Share via Chat
                                    </button>
                                    <button id="copyOfferLink" class="btn btn-secondary">
                                        <span class="icon">ðŸ”—</span> Copy Link
                                    </button>
                                    <button id="copyOfferCode" class="btn btn-secondary">
                                        <span class="icon">ðŸ“‹</span> Copy Code
                                    </button>
                                </div>
                                <div class="connection-preview">
                                    <textarea id="connectionOffer" readonly rows="6"></textarea>
                                </div>
                                <p class="help-text">Waiting for response... (expires in 5 minutes)</p>
                            </div>
                            
                            <!-- Connection Step 3: Process Response/Offer -->
                            <div id="processStep" class="connection-step">
                                <h4>Or: Connect to Another Device</h4>
                                <p>Paste the connection request or response you received:</p>
                                <textarea id="connectionInput" rows="4" placeholder="Paste connection code here..."></textarea>
                                <button id="processConnection" class="btn btn-primary">Connect</button>
                            </div>
                            
                            <!-- Connection Status -->
                            <div id="connectionStatusStep" class="connection-step" style="display: none;">
                                <h4>Connection Status</h4>
                                <div class="status-message" id="connectionStatusMessage"></div>
                                <div class="connected-peers" id="connectedPeersList"></div>
                                <button id="newConnection" class="btn btn-secondary">New Connection</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cloudflare DNS Settings -->
                    <div id="cloudflareSettings" class="discovery-settings" style="display: none;">
                        <div class="form-group">
                            <label for="cloudflareDomain">Your Domain:</label>
                            <input type="text" id="cloudflareDomain" placeholder="example.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="cloudflareZoneId">Zone ID:</label>
                            <input type="text" id="cloudflareZoneId" placeholder="Zone ID from Cloudflare dashboard">
                        </div>
                        
                        <div class="form-group">
                            <label for="cloudflareApiToken">API Token:</label>
                            <input type="password" id="cloudflareApiToken" placeholder="Cloudflare API token with DNS edit permissions">
                            <small class="help-text">Create at: <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank">Cloudflare API Tokens</a></small>
                        </div>
                        
                        <div class="form-group">
                            <label for="cloudflareRoomId">Room ID:</label>
                            <input type="text" id="cloudflareRoomId" placeholder="unique-room-name">
                        </div>
                        
                        <div class="connection-info">
                            <h4>Share with Other Devices</h4>
                            <p>After connecting, you can share these credentials with your iOS device:</p>
                            <button id="generateCloudflareShare" class="btn btn-secondary">Generate Share Code</button>
                            <textarea id="cloudflareShareCode" readonly rows="4" style="display: none; margin-top: 10px;"></textarea>
                        </div>
                    </div>
                    
                    <button id="saveSettings" class="btn btn-primary">Save & Connect</button>
                    <button id="disconnectButton" class="btn btn-danger">Disconnect</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>